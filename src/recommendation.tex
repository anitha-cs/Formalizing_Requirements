\section{Recommendations}
\label{sec:recommendations}

\subsection {Solution To Challenge 1: Structuring Requirements}

Instead of following the trial and error process to refine formalized requirements in ways to verify that requirement, we tried to address this issue at its root cause - the requirement document. The system behaviors of control systems are typically grouped in terms of \emph{modes} - a logical way to describe a set of system behaviours. In a complex system, there could be many modes that could either be mutually exclusive (only one mode can be active at a time) or orthogonal (multiple modes can be active at a time). Lucent understanding of such modes and their groups was crucial to systematically formalize the requirements. In the GPCA, there were three main orthogonal groups of modes - infusion, alarm and configuration. Within each orthogonal group, there were a set of modes that were mutually exclusive of each other. For instance, within infusion mode group basal, intermittent and patient bolus modes are mutually exclusive to each other. We decided to leverage this pattern of modes and use it to organize requirement statements in the the requirements document.

 \begin{figure}[h!]
    \centering
    \includegraphics[width=\columnwidth]{images/structuring.jpg}
    \caption{GPCA System Requirements Structuring}
    \label{fig:gpca-requirements}
 \end{figure}

We restructured the requirement document and followed a hierarchical structure to organize requirements of the GPCA, as shown in Figure~\ref{fig:gpca-requirements} that not only simplified the formalization process, but also brought about conceptually clarity of the requirements. In this structure, the requirements that were common to the entire system, irrespective of the modes, such as startup behavioural requirements were placed at the top of the hierarchy. At the second level in the hierarchy, we placed the three mode groups - infusion, alarm and configuration - that indicated the orthogonality among them. Within each orthogonal mode group, we again followed the hierarchical structure to organize their requirements. The infusion mode group level had three mutually exclusive child modes - basal, intermittent bolus and patient bolus. Additionally, this structure also helps avoid repetition of requirements. While documenting the modal requirements we observed that there were only a few requirements that were specific to each leaf-level infusion modes and several that were common. The hierarchical strcutre allowed us to grouped all the common requirements to a new parent mode called ``therapy", and then organized the three infusion modes as its child modes with specific requirements. 

 \begin{figure}[h!]
    \centering
    \includegraphics[width=\columnwidth]{images/alarm.jpg}
    \caption{Notification Requirements Table}
    \label{fig:gpca-alarm}
 \end{figure}

Within the alarm group, we identified four 4 levels of severity by grouping common system responses described for each condition. We conceptualized the severity level category as parent modes and each condition with them as child modes. This allowed us to categorize the 18 individual conditions within one of the four levels and organize their requirements within the respective severity level. For example, all highest severity conditions caused the system to raise audio alarm, display error message and stop infusion, whereas all low severity level conditions caused the system to display an error message. Although we came across a couple of conditions whose requirements that did not exactly match the requirements of the four groups, we were able to negotiate with our domain experts to match the differences. To make the documentation clear, we used a table to document the conditions and the expected system responses, as shown in Figure~\ref{fig:gpca-alarm}.

This structuring greatly helped in systematically determining the context of each requirement while formalizing it. It provide enough information about the orthogonality and exclusivity among the modes. For instance, by examining the requirements hierarchically from the top level, we were able to precisely formalize the context of the patient bolus infusion requirement such as the operating condition of the system (whether the system is ON/OFF), clinician's inputs that have influence over the entire system and the various levels of exceptional conditions documented in the alarm hierarchy requirements as shown below.
%Infact, in some cases it helped us identify and raise the right questions to discover incomplete requirements within a hierarchical level. Overall this structuring allowed the process of formalization straightforward, that otherwise would have been an ardours trial and error approach.  %Another significant benefit of this structuring is the clarity it provides in documenting the mode transition requirements within infusion modes - descriptions about how and when transitions between those modes occur. We documented the requirements on transitions between the three modes within therapy mode, its immediate parent mode. This strategy allowed us to systematically formalize and verify the mode transition requirements -- a common source of problem in modal systems.
%For example, the formalized requirements for patient bolus infusion was:
\\\\
\footnotesize{\texttt{
SystemOn~and~not(ClinicianInhibits) and not(level2alarms and level3alams and level4alarms) and \\ \textcolor{white}{---}~and~(PatientRequest)~$\Rightarrow$ \\
\textcolor{white}{--------}FlowRate~=~PatientFr}}
\\\normalsize{}\\

Similarly, formalizing the alarm requirements to verify them individually also became straightforward. Grouping the exceptional conditions and its associated actions in the requirements document eased the process of formalizing the requirements. We used variables (or macros) to capture the conditions that cause that alarm level and the desired actions, to avoid repetition in definitions. It then became systematic and straightforward to individually check a requirement. For example, in the GPCA there were 3 exceptional conditions that we categorized as medium level alarms, namely air in line (sensor input indicating air in infusion tube), occlusion (sensor input indicating blockage in infusion tube) and door open (sensor input indicating drug reservoir enclosure is opened). To check the door open requirement exclusively, we systematically excluded the all higher priority level alarm (HiLevelAlarm is a logical disjunction of all conditions within the highest severity level) and the other conditions in its peer level, as shown below :
\\\\
\footnotesize{\texttt{SystemOn and not(HiLevelAlarm) and \\
\textcolor{white}{----}not(AirInLine) and not(Occlusion) and \\ \textcolor{white}{------}(DoorOpen)$\Rightarrow$\\
\textcolor{white}{--------} MedLevelAlarmActions}}
\\\normalsize{}

While such hierarchical structuring is common when trying to model the system or developing source code, it has not be widely used to document requirements in the requirements engineering community. %We found that using such a strategy not only helps organize requirement in a conceptually clear manner, but significantly reduces the effort for formalizing requirements and avoids errors in the process.


\subsection {Solution For Challenge 2: Richer Traceability}

When we identified the issue with the flown down requirement, we started documenting a traceability argument between requirements at adjacent levels in the hierarchy. In addition to just mapping each parent level requirement to its corresponding child requirement, we also documented an argument (a semiformal statement) explaining how the child requirement contributes to satisfying the system level requirement. This sort of assurance argument, inspired from Hammond's work on documenting justification for design decisions~\cite{Hammond01:WiW}, helped us understand the role of each component in satisfying the system requirement. In fact, by documenting this type of richer traceability we were able to identify 10 incorrectly formalized software requirements of the GPCA. Further, this documentation also allowed us to identify component requirements that did not contribute to satisfying any of its parent level requirement. In sum, documenting a richer traceability clarified the role and relevance of each requirement in satisfying its parent requirement that helped identify the mathematical differences between capturing them. To enhance the rigour of this approach, we are currently working towards building an automated traceability capability in the AGREE tool.
%
% \begin{figure}[h!]
%    \centering
%    \includegraphics[width=\columnwidth]{images/traceability.jpg}
%    \caption{Snippet from Richer Traceability Document}
%    \label{fig:gpca-alarm}
% \end{figure}
 

\subsection {Solution For Challenge 3: Sanity Checks and Fallibility Detection}

We believe that the root cause of the problem of the AGREE tool not identifying the consistency issues was not the tool's default setting, but the fact that it was not apparent in the results. Hence, to address the issue from the tool side we requested the tool developers to provide elaborate messages of certain key configurations when using the features. After that change, AGREE now displays the depth of consistency check along with the results. While such a change may not be possible with every tool and feature we use, we strongly recommend the engineers to delve deep into the details and configuration of tool to precisely understand the results, especially when there is limited information provided by the tool along with the results.

\subsection {Solution For Challenge 4: Automating Verifiers}

\anitha{I need to write a little about the tools above helps identify these issues + need translators and rigours process} 